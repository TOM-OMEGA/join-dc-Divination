<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<title>å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</title>

<link rel="icon" href="images/favicon.ico" type="image/x-icon">
<meta name="theme-color" content="#000000">

<style>
:root{
  --paper:#f3ead5;
  --ink:#2e2316;
  --gold:#b9872b;

  /* ç¬¬ä¸‰é æ–‡å­—èˆ‡é–“è·æ§åˆ¶ */
  --fortune-offset:5vh;
  --fortune-left-offset:110px;
  --advice-left-offset: 50px;
  --fortune-gap:150px;
  --draw-btn-gap:10px;

  /* åœ–ç¤ºå¤§å° */
  --carrot-size-min:150px;
  --carrot-size-max:220px;

  /* æŒ‰éˆ•å¤§å° */
  --btn-width:200px;
  --btn-height:64px;
}

/* å­—é«”è¨­å®š */
@font-face {
  font-family: 'MyChineseFont';
  src: url('/join-dc-Divination/fonts/MyChineseFont.woff') format('woff');
  font-display: swap;
}

@font-face {
  font-family: 'HanyiSentyPagoda';
  src: url('/join-dc-Divination/fonts/HanyiSentyPagoda-fixed.woff') format('woff'),
       url('/join-dc-Divination/fonts/HanyiSentyPagoda-fixed.ttf') format('truetype');
  font-display: swap;
}

/* å…¨åŸŸæ¨£å¼ */
html, body{
  width:100%; height:100%; margin:0; padding:0;
  font-family:'MyChineseFont','Uncial Antiqua',serif;
  background:url('./images/medieval-carrot-placeholder.webp') no-repeat center center;
  background-size:contain; background-color:#000;
  color:var(--ink);
  overflow:hidden;
  display:flex; align-items:center; justify-content:center;
  transition:background-image 1s ease-in-out;
}

/* é é¢å…±é€š */
.page{
  position:absolute; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transform:scale(0.97);
  transition:opacity .8s ease, transform .8s ease;
}
.page.active{opacity:1; pointer-events:all; transform:scale(1);}

/* ç¬¬1é  */
#page1 h1{font-size:clamp(3rem,12vw,3.8rem); color:#4d2b0a; margin-bottom:1rem; text-align:center;}
#page1 .subtitle{font-size:clamp(1.2rem, 5vw, 1.8rem); color:#333; text-align:center;}

/* ç¬¬2é ï¼šå…”å…”æ’ç•«é é¢ */
#page2 h1{font-size:clamp(2.5rem,8vw,3.2rem); color:#4d2b0a; text-align:center; margin-bottom:1rem;}
.rabbit-illustration {
  width: clamp(200px, 45vw, 350px);
  height: auto;
  margin-bottom: 20px;
  filter: drop-shadow(2px 2px 5px rgba(0,0,0,0.1));
}
.ritual-text {
  font-size: clamp(1.3rem, 4vw, 1.6rem); 
  line-height: 1.8;
  color: #4b2d0a;
  text-align:center;
  margin-bottom: 25px;
  max-width: 85%;
}

/* ç¬¬3é ï¼šå åœä¸»é«” */
#page3{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; width:100%; height:100%; box-sizing:border-box;
}
#page3.left-align{ align-items:flex-start; text-align:left; padding-left:40px; }

@media screen and (max-width:768px) and (orientation:portrait){
  #page3.left-align{align-items:center!important;text-align:center!important;padding-left:0!important;}
}

.carrot-thumb{
  width:clamp(var(--carrot-size-min),25vw,var(--carrot-size-max));
  height:auto;
  object-fit:contain; 
  margin-bottom: 5px;
  transition:opacity .6s ease;
}

.fortune-block{
  display:flex; flex-direction:column; align-items:center;
  gap: 5px; margin-bottom:0;
}

.fortune { font-size: clamp(1.6rem, 5vw, 2.2rem); color: #4d2b0a; margin: 0; }

.fortune-text-container{
  position:absolute;
  top: var(--fortune-offset);
  left: var(--fortune-left-offset);
  font-family:'HanyiSentyPagoda', serif;
  font-size: clamp(8rem,12vw,12rem);
  color:#4d2b0a;
}

.advice {
  position: relative;
  margin-top: var(--fortune-gap);
  left: var(--advice-left-offset);
  font-size: clamp(1.2rem, 2rem, 1.8rem);
  line-height: 1.6;
  max-width: 600px;
  text-align: left;
}

/* æŒ‰éˆ•æ¨£å¼ */
.button-row{ display:flex; gap:10px; margin-top: 10px;}
.btn{
  width:var(--btn-width); height:var(--btn-height);
  background-repeat:no-repeat; background-position:center; background-size:contain;
  background-color:transparent; border:0; cursor:pointer;
}
.btn:hover{transform:translateY(-3px) scale(1.02); filter:brightness(1.06);}

.btn--start{background-image:url('./images/btn-start.png');}
.btn--next{background-image:url('./images/btn-next.png');}
.btn--draw{background-image:url('./images/btn-draw.png');}
.btn--back{background-image:url('./images/btn-back.png');}

.fade-out{opacity:0!important; transition:opacity .5s;}
.fade-in{opacity:1!important; transition:opacity .5s;}

footer{position:absolute; bottom:8px; font-size:.75rem; color:rgba(46,34,22,0.6);}
</style>
</head>
<body>

<div id="page1" class="page active">
  <h1>å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</h1>
  <div class="subtitle">æ¢ç´¢å‘½é‹çš„å„€å¼ï¼Œå¾åŠ å…¥é–‹å§‹</div>
  <button id="startBtn" class="btn btn--start"></button>
  <footer>Â© 2025 å‘½é‹ä¹‹è””</footer>
</div>

<div id="page2" class="page">
  <h1>é–‰ä¸Šé›™çœ¼ï¼Œèˆ‡ç¥­å£‡å…±é³´</h1>
  <img src="images/å…”å…”.png" alt="ä¸­ä¸–ç´€å…”å…”" class="rabbit-illustration">
  <div class="ritual-text">åœ¨æŒ‡å°–è§¸ç¢°éˆé­‚ä¹‹å‰ï¼Œ<br>è«‹å…ˆè½è¦‹æ£®æ—çš„å‘¼å¸ã€‚</div>
  <button id="joinedBtn" class="btn btn--next"></button>
</div>

<div id="page3" class="page">
  <img id="carrotThumb" class="carrot-thumb" src="./images/carrot-thumb.png">
  <div class="fortune-block">
    <div class="fortune" id="fortuneLine">æŒ‰ä¸‹ <strong>å åœé‹å‹¢</strong> æŒ–å–ä½ çš„å‘½é‹ä¹‹è””</div>
    <div class="fortune-text-container" id="fortuneResult"></div>
    <div class="advice" id="adviceText" style="display:none"></div>
  </div>
  <div class="button-row">
    <button id="drawBtn" class="btn btn--draw"></button>
    <button id="backBtn" class="btn btn--back"></button>
  </div>
</div>

<script>
const apiUrl="https://carrot-bot.onrender.com/api/web_fortune";
const userId="657882539331158016";
const username="æ¹¯å§†ç‘æ–—";

function transitionPage(cur,next){
  const curPage=document.getElementById(cur);
  const nextPage=document.getElementById(next);
  curPage.classList.add('fade-out');
  setTimeout(()=>{
    curPage.classList.remove('active','fade-out');
    nextPage.classList.add('active','fade-in');
    setTimeout(()=>nextPage.classList.remove('fade-in'),500);
  },400);
}

document.getElementById('startBtn').onclick = ()=>transitionPage('page1','page2');
document.getElementById('joinedBtn').onclick = ()=>transitionPage('page2','page3');
document.getElementById('backBtn').onclick = ()=>location.reload();

const drawBtn=document.getElementById('drawBtn');
const fortuneLine=document.getElementById('fortuneLine');
const fortuneResult=document.getElementById('fortuneResult');
const adviceText=document.getElementById('adviceText');
const carrotThumb=document.getElementById('carrotThumb');
const page3=document.getElementById('page3');

drawBtn.addEventListener('click', async ()=>{
  drawBtn.disabled = true;
  fortuneLine.innerHTML = "ğŸ¥• æ­£åœ¨æ‹”å‡ºä½ çš„å‘½é‹ä¹‹è””...";
  
  const anim = carrotThumb.animate(
    [{ transform: 'translateY(0)' }, { transform: 'translateY(-15px)' }, { transform: 'translateY(0)' }],
    { duration: 800, iterations: Infinity, easing: 'ease-in-out' }
  );

  try {
    const res = await fetch(`${apiUrl}?user_id=${userId}&username=${username}&force_random=true&t=${Date.now()}`);
    const data = await res.json();
    const fortune = data.fortune || "";
    let fText = "å‰", bg = "./images/fortune_default.png";

    if (fortune.includes("å¤§å‰")) { fText = "å¤§å‰"; bg = "./images/å¤§å‰.webp"; }
    else if (fortune.includes("ä¸­å‰")) { fText = "ä¸­å‰"; bg = "./images/ä¸­å‰.webp"; }
    else if (fortune.includes("å°å‰")) { fText = "å°å‰"; bg = "./images/å°å‰.webp"; }
    else if (fortune.includes("å‰")) { fText = "å‰"; bg = "./images/å‰.webp"; }
    else if (fortune.includes("å‡¶")) { fText = "å‡¶"; bg = "./images/å‡¶.webp"; }

    setTimeout(() => {
      anim.cancel();
      page3.classList.add('left-align'); 
      carrotThumb.style.display = 'none';
      document.body.style.background = `url('${bg}') no-repeat center center/cover`;
      
      fortuneLine.innerHTML = '';
      fortuneResult.innerHTML = fText;
      adviceText.style.display = 'block';
      adviceText.innerHTML = `<p><span>${data.advice}</span></p>`;
      drawBtn.disabled = false;
    }, 4000);

  } catch (e) {
    anim.cancel();
    fortuneLine.innerHTML = 'âš ï¸ ç¥­å£‡æ„Ÿæ‡‰ä¸­æ–·';
    drawBtn.disabled = false;
  }
});
</script>
</body>
</html>
