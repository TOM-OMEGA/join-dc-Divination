<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å‘½é‹ä¹‹è”” Â· ä¸­ä¸–ç´€å åœç¥­å£‡</title>

  <!-- å¤é¢¨å­—é«” -->
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">

  <style>
    :root {
      --paper: #f3ead5;
      --ink: #2e2316;
      --gold: #b9872b;
      --max-width: 980px;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: "Uncial Antiqua", serif;
      background: url('images/scroll-bg.jpg') repeat center center fixed;
      background-size: cover;
      color: var(--ink);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stage {
      box-sizing: border-box;
      width: var(--max-width);
      max-width: 95%;
      <body>
  <div class="stage" role="main" aria-labelledby="title" id="mainStage">
    <header>
      <div class="title">
        <div class="crest" aria-hidden="true">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 2c2.8 0 5 2.2 5 5 0 1.9-.9 3.6-2.3 4.7L12 18 9.3 11.7C7.9 10.6 7 8.9 7 7c0-2.8 2.2-5 5-5z"/>
          </svg>
        </div>
        <div>
          <h1 id="title">å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</h1>
          <div class="subtitle">åŠ å…¥ Discord ä¸¦é ˜å–ä½ çš„å°ˆå±¬èƒ¡è˜¿è””å åœ</div>
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-size:0.86rem;color:rgba(46,34,22,0.6)">ä¸­ä¸–ç´€æ‰‹æŠ„æœ¬é¢¨ Â· èŠåš´ç¥ç§˜</div>
      </div>
    </header>

    <section class="content">
      <!-- é¦–é  QR å€å¡Š -->
      <div class="panel" id="home-panel">
        <div class="qr-wrap">
          <div class="qr" title="æƒæåŠ å…¥ Discord">
            <img id="qr-img" alt="Discord QR" src="https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=https://discord.gg/mar4qT9XYn" />
          </div>
          <div class="muted">æƒææˆ–é»æ“Š QR åŠ å…¥ Discord ç¾¤çµ„</div>
          <a href="https://discord.gg/mar4qT9XYn" target="_blank" rel="noopener" class="btn secondary">æ‰“é–‹ Discord é‚€è«‹é€£çµ</a>
        </div>
        <div style="margin-top:14px;">
          <div style="font-weight:700;margin-bottom:8px">æ­¥é©Ÿ</div>
          <ol style="margin:0 0 8px 18px;color:rgba(46,34,22,0.8)">
            <li>æƒæä¸Šæ–¹ QR æˆ–é»æ“Šé‚€è«‹åŠ å…¥ Discord</li>
            <li>å®Œæˆå¾Œå›åˆ°æ­¤é æŒ‰ã€Œæˆ‘å·²åŠ å…¥ã€ç¹¼çºŒå åœ</li>
          </ol>
          <button id="joinedBtn" class="btn" title="æˆ‘å·²åŠ å…¥">æˆ‘å·²åŠ å…¥</button>
        </div>
        <hr style="margin:12px 0;border:none;border-top:1px dashed rgba(0,0,0,0.06)">
        <div style="font-size:0.92rem;color:rgba(46,34,22,0.72)">
          <strong>æ³¨æ„ï¼š</strong>å¯æ›¿æ›èƒŒæ™¯åœ–ï¼ˆ<code>images/scroll-bg.jpg</code>ï¼‰èˆ‡ç¸®åœ–ï¼ˆ<code>images/carrot-thumb.png</code>ï¼‰ã€‚
        </div>
      </div>
      <!-- å åœç•«é¢ -->
      <div class="divination" id="divination-panel" aria-hidden="true">
        <div class="div-inner">
          <div class="magic-plate">
            <img id="carrotThumb" class="carrot-thumb" src="images/carrot-thumb.png" alt="èƒ¡è˜¿è””æ’ç•«" onerror="this.style.display='none'">
            <div class="fortune" id="fortuneLine">æŒ‰ä¸‹ <strong>å åœä»Šæ—¥é‹å‹¢</strong> ä¾†å–šé†’å‘½é‹ä¹‹è””</div>
            <div class="advice" id="adviceText"></div>
            <div class="small-row">
              <button id="drawBtn" class="btn">å åœä»Šæ—¥é‹å‹¢ âœ¨</button>
              <button id="backBtn" class="btn secondary">è¿”å›é¦–é </button>
            </div>
          </div>
          <div style="margin-top:8px;color:rgba(46,34,22,0.6);font-size:0.88rem">å åœä½¿ç”¨ï¼šä½ çš„ bot APIï¼ˆå·²é€£ç·šï¼‰</div>
        </div>
      </div>
    </section>

    <footer>Â© å‘½é‹ä¹‹è”” Â· ç¥­å£‡ç³»çµ±</footer>
  </div>
      <script>
const apiUrl = "https://carrot-bot-production.up.railway.app/api/fortune";
const userId = "657882539331158016";
const username = "æ¹¯å§†ç‘æ–—";

const joinedBtn = document.getElementById('joinedBtn');
const divinationPanel = document.getElementById('divination-panel');
const homePanel = document.getElementById('home-panel');
const drawBtn = document.getElementById('drawBtn');
const fortuneLine = document.getElementById('fortuneLine');
const adviceText = document.getElementById('adviceText');
const backBtn = document.getElementById('backBtn');

// åˆ‡æ›åˆ°å åœç•«é¢
joinedBtn.addEventListener('click', () => {
  homePanel.style.display = 'none';
  divinationPanel.classList.add('show');
});

// è¿”å›é¦–é 
backBtn.addEventListener('click', () => {
  divinationPanel.classList.remove('show');
  homePanel.style.display = '';
});

// å åœæŒ‰éˆ•
drawBtn.addEventListener('click', async () => {
  drawBtn.disabled = true;
  drawBtn.textContent = 'å åœä¸­... ğŸ”®';
  fortuneLine.innerHTML = 'å åœä¸­... è«‹ç¨å€™';
  adviceText.innerHTML = '';

  try {
    const res = await fetch(`${apiUrl}?user_id=${encodeURIComponent(userId)}&username=${encodeURIComponent(username)}`);
    if (!res.ok) throw new Error('API å›å‚³éŒ¯èª¤');
    const data = await res.json();

    fortuneLine.innerHTML = `ğŸ“œ å åœæ—¥æœŸï¼š<strong>${escapeHtml(data.date || new Date().toLocaleDateString())}</strong>`;
    adviceText.innerHTML = `
      <p style="margin:6px 0;"><strong style="color:var(--gold)">${escapeHtml(data.fortune || 'éœé»˜')}</strong></p>
      <p style="margin-top:6px">${escapeHtml(data.advice || 'ç„¡å»ºè­°')}</p>
    `;
    drawBtn.textContent = 'å†æ¬¡å åœ';
  } catch (e) {
    fortuneLine.innerHTML = 'âš ï¸ å åœå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦';
    adviceText.innerHTML = '<p>é­”åŠ›å¹²æ“¾éå¼·ï¼Œç„¡æ³•å¾ç¥­å£‡è®€å–å‘½é‹ã€‚</p>';
    drawBtn.textContent = 'å†è©¦ä¸€æ¬¡';
  } finally {
    drawBtn.disabled = false;
  }
});

function escapeHtml(s){
  return String(s||'').replace(/[&<>"']/g, c => ({
    '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'
  }[c]));
}
</script>
</body>
</html>
