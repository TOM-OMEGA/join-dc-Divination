<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<title>å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</title>

<link rel="icon" href="images/favicon.ico" type="image/x-icon">
<meta name="theme-color" content="#000000">

<style>
:root{
  --paper:#f3ead5;
  --ink:#2e2316;
  --gold:#b9872b;

  /* ç¬¬ä¸‰é æ–‡å­—èˆ‡é–“è·æ§åˆ¶ */
  --fortune-offset: 8vh;       /* ç¨å¾®ä¸‹ç§»ï¼Œé¿å…å£“åˆ°é ‚éƒ¨é‚Šæ¡† */
  --fortune-left-offset: 12vw; /* æ”¹ç”¨ç™¾åˆ†æ¯”ï¼Œæ›´é©æ‡‰ä¸åŒè¢å¹• */
  --advice-left-offset: 0px;   /* åŸºæº–æ”¹ç‚ºèˆ‡å®¹å™¨å°é½Š */
  --fortune-gap: 160px;
  --draw-btn-gap: 10px;

  /* åœ–ç¤ºå¤§å° */
  --carrot-size-min: 150px;
  --carrot-size-max: 220px;

  /* æŒ‰éˆ•å¤§å° */
  --btn-width: clamp(140px, 18vw, 200px); /* è®“æŒ‰éˆ•å¯¬åº¦æœ‰å½ˆæ€§ */
  --btn-height: 64px;
}

/* å­—é«”è¨­å®š */
@font-face {
  font-family: 'MyChineseFont';
  src: url('/join-dc-Divination/fonts/MyChineseFont.woff') format('woff');
  font-display: swap;
}

@font-face {
  font-family: 'HanyiSentyPagoda';
  src: url('/join-dc-Divination/fonts/HanyiSentyPagoda-fixed.woff') format('woff'),
       url('/join-dc-Divination/fonts/HanyiSentyPagoda-fixed.ttf') format('truetype');
  font-display: swap;
}

/* å…¨åŸŸæ¨£å¼ */
html, body{
  width:100%; height:100%; margin:0; padding:0;
  font-family:'MyChineseFont','Uncial Antiqua',serif;
  background:url('./images/medieval-carrot-placeholder.webp') no-repeat center center;
  background-size:contain; background-color:#000;
  color:var(--ink);
  overflow:hidden;
  display:flex; align-items:center; justify-content:center;
  transition:background-image 1s ease-in-out;
}

/* é é¢å…±é€š */
.page{
  position:absolute; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; transform:scale(0.97);
  transition:opacity .8s ease, transform .8s ease;
  box-sizing: border-box;
  padding: 20px;
}
.page.active{opacity:1; pointer-events:all; transform:scale(1);}

/* ç¬¬1é  */
#page1 h1{font-size:clamp(3rem,12vw,3.8rem); color:#4d2b0a; margin-bottom:1rem; text-align:center;}
#page1 .subtitle{font-size:35pt; color:#333; text-align:center;}

/* ç¬¬2é ï¼šä¿æŒä½ çš„è¨­å®š */
#page2 h1{
  font-size:clamp(1.3rem, 5vw, 2.3rem); 
  color:#4d2b0a; 
  text-align:center; 
  margin-bottom:0.2rem;
}
.rabbit-illustration {
  max-width: 250px; 
  max-height: 50vh;
  width: auto;
  height: auto;
  margin-bottom: 1px;
  object-fit: contain;
}

/* ç¬¬3é ï¼šä¿®æ­£çµæœé¡¯ç¤ºæ™‚çš„å°é½Šèˆ‡æŒ‰éˆ•é‚Šç•Œ */
#page3{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; width:100%; height:100%; box-sizing:border-box;
  transition: all 0.6s ease;
}

/* ğŸ’¡ ä¿®æ­£ï¼šçµæœé é¢çš„å…§ç¸®ï¼Œé˜²æ­¢æŒ‰éˆ•å£“é‚Š */
#page3.left-align{
  align-items: flex-start; 
  text-align: left; 
  padding: 5vh 10vw; /* å¢åŠ å·¦å³å…§ç¸®ï¼Œç¢ºä¿ä¸å£“é‚Š */
}

@media screen and (max-width:768px) and (orientation:portrait){
  #page3.left-align{
    align-items:center!important;
    text-align:center!important;
    padding: 20px!important;
  }
}

.carrot-thumb{
  width:clamp(var(--carrot-size-min),25vw,var(--carrot-size-max));
  height:clamp(var(--carrot-size-min),25vw,var(--carrot-size-max));
  object-fit:contain; 
  transition:opacity .6s ease, transform .4s ease;
  margin-bottom: 5px; 
}

.fortune-block{
  display:flex; flex-direction:column; align-items:center;
  gap: 5px;
  margin-bottom:0;
}

/* ç•¶çµæœå‡ºä¾†å¾Œï¼Œè®“ block é å·¦å°é½Š */
#page3.left-align .fortune-block {
  align-items: flex-start;
}

.fortune {
  font-size: clamp(1.6rem, 5vw, 2.2rem); 
  color: #4d2b0a;
  margin: 0;
}

.fortune-text-container{
  position:absolute;
  top: var(--fortune-offset);
  left: var(--fortune-left-offset);
  font-family:'HanyiSentyPagoda', serif;
  font-size: clamp(7rem, 11vw, 11rem); /* ç¨å¾®ç¸®å°é˜²æ­¢å£“æ¡† */
  pointer-events:none; white-space:nowrap;
  color:#4d2b0a;
}

.advice {
  position: relative;
  margin-top: var(--fortune-gap);
  left: var(--advice-left-offset);
  font-size: clamp(1.1rem, 1.8rem, 1.6rem);
  line-height: 1.5;
  max-width: 550px;
  color: #4b2d0a;
  text-align: left;
}

/* ğŸ’¡ ä¿®æ­£ï¼šæŒ‰éˆ•åˆ—å°é½Šè¨­å®š */
.button-row{ 
  display:flex; 
  flex-direction:row; 
  align-items:center; 
  justify-content:center; 
  gap:10px; 
  margin-top: 15px;
  width: auto;
}

#page3.left-align .button-row {
  justify-content: flex-start; /* çµæœé é¢æ™‚é å·¦å°é½Š */
  padding-left: 0;
}

.btn{
  width:var(--btn-width); height:var(--btn-height);
  display:inline-block; background-repeat:no-repeat; background-position:center; background-size:contain;
  background-color:transparent; border:0; padding:0; margin:5px; cursor:pointer; z-index:10;
}
.btn:hover{transform:translateY(-3px) scale(1.02); filter:brightness(1.06);}

.btn--start{background-image:url('./images/btn-start.png');}
.btn--next{background-image:url('./images/btn-next.png');}
.btn--draw{background-image:url('./images/btn-draw.png');}
.btn--back{background-image:url('./images/btn-back.png');}
.btn--retry{background-image:url('./images/btn-retry.png');}

.fade-out{opacity:0!important; transform:scale(.95); transition:opacity .6s,transform .6s;}
.fade-in{opacity:1!important; transform:scale(1); transition:opacity .6s,transform .6s;}

footer{position:absolute; bottom:8px; font-size:.75rem; color:rgba(46,34,22,0.6);}
</style>
</head>
<body>

<div id="page1" class="page active">
  <h1>å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</h1>
  <div class="subtitle">æ¢ç´¢å‘½é‹çš„å„€å¼ï¼Œå¾åŠ å…¥é–‹å§‹</div>
  <button id="startBtn" class="btn btn--start"></button>
  <footer>Â© 2025 å‘½é‹ä¹‹è””</footer>
</div>

<div id="page2" class="page">
  <h1>åœ¨å åœä¹‹å‰ï¼Œé ˜å–å‚³é€æ³•é™£ éš¨å¼•è·¯äººå‰å¾€è–æ‰€</h1>
  <img src="images/å…”å…”.png" class="rabbit-illustration">
  <button id="joinedBtn" class="btn btn--next"></button>
</div>

<div id="page3" class="page">
  <img id="carrotThumb" class="carrot-thumb" src="./images/carrot-thumb.png">
  <div class="fortune-block">
    <div class="fortune" id="fortuneLine">æŒ‰ä¸‹ <strong>å åœé‹å‹¢</strong> æŒ–å–ä½ çš„å‘½é‹ä¹‹è””</div>
    <div class="fortune-text-container" id="fortuneResult"></div>
    <div class="advice" id="adviceText" style="display:none"></div>
  </div>
  <div class="button-row">
    <button id="drawBtn" class="btn btn--draw"></button>
    <button id="backBtn" class="btn btn--back"></button>
  </div>
</div>

<script>
const apiUrl="https://carrot-bot.onrender.com/api/web_fortune";
const userId="657882539331158016";
const username="æ¹¯å§†ç‘æ–—";

function transitionPage(cur,next){
  const curPage=document.getElementById(cur);
  const nextPage=document.getElementById(next);
  curPage.classList.add('fade-out');
  setTimeout(()=>{
    curPage.classList.remove('active','fade-out');
    nextPage.classList.add('active','fade-in');
    setTimeout(()=>nextPage.classList.remove('fade-in'),600);
  },500);
}

document.getElementById('startBtn').onclick = ()=>transitionPage('page1','page2');
document.getElementById('joinedBtn').onclick = ()=>transitionPage('page2','page3');
document.getElementById('backBtn').onclick = ()=>location.reload();

const drawBtn=document.getElementById('drawBtn');
const fortuneLine=document.getElementById('fortuneLine');
const fortuneResult=document.getElementById('fortuneResult');
const adviceText=document.getElementById('adviceText');
const carrotThumb=document.getElementById('carrotThumb');
const page3=document.getElementById('page3');

drawBtn.addEventListener('click', async ()=>{
  drawBtn.disabled = true;
  fortuneLine.innerHTML = "ğŸ¥• æ­£åœ¨æ‹”å‡ºä½ çš„å‘½é‹ä¹‹è””...";
  
  const anim = carrotThumb.animate(
    [{ transform: 'translateY(0)' }, { transform: 'translateY(-15px)' }, { transform: 'translateY(0)' }],
    { duration: 800, iterations: Infinity, easing: 'ease-in-out' }
  );

  try {
    const res = await fetch(`${apiUrl}?user_id=${userId}&username=${username}&force_random=true&t=${Date.now()}`);
    const data = await res.json();
    const fortune = data.fortune || "";
    let fText = "å‰";
    let bg = "./images/fortune_default.png";

    if (fortune.includes("å¤§å‰")) { fText = "å¤§å‰"; bg = "./images/å¤§å‰.webp"; }
    else if (fortune.includes("ä¸­å‰")) { fText = "ä¸­å‰"; bg = "./images/ä¸­å‰.webp"; }
    else if (fortune.includes("å°å‰")) { fText = "å°å‰"; bg = "./images/å°å‰.webp"; }
    else if (fortune.includes("å‰")) { fText = "å‰"; bg = "./images/å‰.webp"; }
    else if (fortune.includes("å‡¶")) { fText = "å‡¶"; bg = "./images/å‡¶.webp"; }

    setTimeout(() => {
      anim.cancel();
      page3.classList.add('left-align'); 
      carrotThumb.style.display = 'none';
      document.body.style.background = `url('${bg}') no-repeat center center/cover`;
      
      fortuneLine.innerHTML = '';
      fortuneResult.innerHTML = fText;
      adviceText.style.display = 'block';
      adviceText.innerHTML = `<p><span>${data.advice}</span></p>`;
      drawBtn.disabled = false;
    }, 4000);

  } catch (e) {
    anim.cancel();
    fortuneLine.innerHTML = 'âš ï¸ ç¥­å£‡æ„Ÿæ‡‰ä¸­æ–·';
    drawBtn.disabled = false;
  }
});
</script>
</body>
</html>
