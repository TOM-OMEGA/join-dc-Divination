<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<title>å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</title>

<link rel="icon" href="images/favicon.ico" type="image/x-icon">
<meta name="theme-color" content="#000000">

<style>
:root{
  --paper:#f3ead5;
  --ink:#2e2316;
  --gold:#b9872b;

  /* é‹å‹¢é¡¯ç¤ºåç§»é‡ */
  --fortune-offset: 5vh;
  --fortune-left-offset: 110px;
  --advice-left-offset: 50px;
  --fortune-gap: 130px;

  /* æŒ‰éˆ•å¤§å° */
  --btn-width: 180px;
  --btn-height: 58px;
}

@font-face {
  font-family: 'MyChineseFont';
  src: url('/join-dc-Divination/fonts/MyChineseFont.woff') format('woff');
  font-display: swap;
}

@font-face {
  font-family: 'HanyiSentyPagoda';
  src: url('/join-dc-Divination/fonts/HanyiSentyPagoda-fixed.woff') format('woff'),
       url('/join-dc-Divination/fonts/HanyiSentyPagoda-fixed.ttf') format('truetype');
  font-display: swap;
}

html, body{
  width:100%; height:100%; margin:0; padding:0;
  font-family:'MyChineseFont', serif;
  background:url('./images/medieval-carrot-placeholder.webp') no-repeat center center;
  background-size:contain; background-color:#000;
  color:var(--ink);
  overflow:hidden;
  display:flex; align-items:center; justify-content:center;
}

.page{
  position:absolute; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  opacity:0; pointer-events:none; box-sizing: border-box;
  padding: 15px;
  transition: opacity .6s ease, transform .6s ease;
  transform: scale(0.98);
}
.page.active{opacity:1; pointer-events:all; transform: scale(1);}

/* æ¨™é¡Œèˆ‡æ–‡å­—ç¸®æ”¾ */
h1 { font-size: clamp(1.8rem, 6vw, 3rem); color:#4d2b0a; margin: 0 0 10px 0; text-align: center; }
.subtitle, .ritual-text {
  font-size: clamp(1rem, 3.5vw, 1.4rem); 
  line-height: 1.5;
  text-align: center;
  margin-bottom: 15px;
}

/* ç¬¬2é ï¼šå…”å…”æ’ç•« (åŸæœ¬ QRcode ä½ç½®) */
.rabbit-illustration {
  max-width: 320px;
  max-height: 30vh; /* ğŸ’¡ é—œéµï¼šé™åˆ¶é«˜åº¦é˜²æ­¢æ“ å£“æ–‡å­— */
  width: auto;
  height: auto;
  margin-bottom: 15px;
  filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
}

/* ç¬¬3é ï¼šå åœç•«é¢ */
.carrot-thumb {
  max-width: 200px;
  max-height: 25vh;
  width: auto;
  height: auto;
  margin-bottom: 10px;
  transition: transform 0.4s;
}

.fortune-block {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
}

.fortune { font-size: clamp(1.3rem, 4vw, 1.8rem); margin: 0 0 5px 0; }

#fortuneResult {
  font-family: 'HanyiSentyPagoda', serif;
  font-size: clamp(6rem, 15vw, 10rem);
  color: #4d2b0a;
  margin: 10px 0;
}

.advice {
  font-size: clamp(1rem, 1.3rem, 1.2rem);
  line-height: 1.4;
  max-width: 85%;
  text-align: left;
  border-left: 2px solid var(--gold);
  padding-left: 10px;
}

/* æŒ‰éˆ• row */
.button-row { display: flex; gap: 10px; margin-top: 10px; }
.btn {
  width: var(--btn-width); height: var(--btn-height);
  background-repeat: no-repeat; background-position: center; background-size: contain;
  background-color: transparent; border: 0; cursor: pointer;
  transition: transform 0.2s;
}
.btn:hover { transform: scale(1.05); }

/* è·¯å¾‘å°æ‡‰ */
.btn--start{background-image:url('./images/btn-start.png');}
.btn--next{background-image:url('./images/btn-next.png');}
.btn--draw{background-image:url('./images/btn-draw.png');}
.btn--back{background-image:url('./images/btn-back.png');}

footer { position: absolute; bottom: 5px; font-size: 0.6rem; opacity: 0.5; }
</style>
</head>
<body>

<div id="page1" class="page active">
  <h1>å‘½é‹ä¹‹è”” Â· æ£®æ—å åœç¥­å£‡</h1>
  <div class="subtitle">æ¢ç´¢å‘½é‹çš„å„€å¼ï¼Œå¾åŠ å…¥é–‹å§‹</div>
  <button id="startBtn" class="btn btn--start"></button>
</div>

<div id="page2" class="page">
  <h1>é–‰ä¸Šé›™çœ¼ï¼Œèˆ‡ç¥­å£‡å…±é³´</h1>
  <img src="images/å…”å…”.png" class="rabbit-illustration" alt="å‘½é‹ä¹‹å…”">
  <div class="ritual-text">åœ¨æŒ‡å°–è§¸ç¢°éˆé­‚ä¹‹å‰ï¼Œ<br>è«‹å…ˆè½è¦‹æ£®æ—çš„å‘¼å¸ã€‚</div>
  <button id="joinedBtn" class="btn btn--next"></button>
</div>

<div id="page3" class="page">
  <img id="carrotThumb" class="carrot-thumb" src="./images/carrot-thumb.png">
  <div class="fortune-block">
    <div class="fortune" id="fortuneLine">æŒ‰ä¸‹ <strong>å åœé‹å‹¢</strong> æŒ–å–ä½ çš„å‘½é‹ä¹‹è””</div>
    <div id="fortuneResult"></div>
    <div class="advice" id="adviceText" style="display:none"></div>
  </div>
  <div class="button-row">
    <button id="drawBtn" class="btn btn--draw"></button>
    <button id="backBtn" class="btn btn--back"></button>
  </div>
</div>

<script>
const apiUrl="https://carrot-bot.onrender.com/api/web_fortune";
const userId="657882539331158016";
const username="æ¹¯å§†ç‘æ–—";

function transitionPage(cur, next) {
  const curPage = document.getElementById(cur);
  const nextPage = document.getElementById(next);
  curPage.classList.remove('active');
  setTimeout(() => {
    nextPage.classList.add('active');
  }, 300);
}

document.getElementById('startBtn').onclick = () => transitionPage('page1', 'page2');
document.getElementById('joinedBtn').onclick = () => transitionPage('page2', 'page3');
document.getElementById('backBtn').onclick = () => location.reload();

const drawBtn = document.getElementById('drawBtn');
const fortuneLine = document.getElementById('fortuneLine');
const fortuneResult = document.getElementById('fortuneResult');
const adviceText = document.getElementById('adviceText');
const carrotThumb = document.getElementById('carrotThumb');

drawBtn.addEventListener('click', async () => {
  drawBtn.disabled = true;
  fortuneLine.innerHTML = "ğŸ¥• æ­£åœ¨æ‹”å‡ºå‘½é‹...";
  
  const anim = carrotThumb.animate(
    [{ transform: 'translateY(0)' }, { transform: 'translateY(-10px)' }, { transform: 'translateY(0)' }],
    { duration: 600, iterations: Infinity }
  );

  try {
    const res = await fetch(`${apiUrl}?user_id=${userId}&username=${username}&force_random=true&t=${Date.now()}`);
    const data = await res.json();
    
    setTimeout(() => {
      anim.cancel();
      carrotThumb.style.display = 'none';
      fortuneLine.innerHTML = "ä½ çš„å‘½é‹ä¹‹è””æ˜¯ï¼š";
      fortuneResult.innerHTML = data.fortune.substring(0, 2); // å–å¾—ã€Œå¤§å‰ã€ç­‰å­—æ¨£
      adviceText.style.display = 'block';
      adviceText.innerHTML = data.advice;
      drawBtn.style.display = 'none'; // å åœå¾Œéš±è—æŒ‰éˆ•
    }, 2000);
  } catch (e) {
    anim.cancel();
    fortuneLine.innerHTML = "âš ï¸ é€£çµæ–·é–‹";
    drawBtn.disabled = false;
  }
});
</script>
</body>
</html>
